<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atlas Codex - Web Scraping Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        .tab-active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .mini-loader {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .info-box {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-left: 3px solid #667eea;
        }
        .example-box {
            background: #f7fafc;
            border: 1px dashed #cbd5e0;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Example JSON schemas for different use cases
        const EXAMPLE_SCHEMAS = {
            product: {
                name: 'E-commerce Product',
                schema: {
                    title: "string",
                    price: "number",
                    currency: "string",
                    availability: "boolean",
                    description: "string",
                    images: ["string"],
                    specifications: {
                        brand: "string",
                        model: "string",
                        features: ["string"]
                    },
                    rating: {
                        score: "number",
                        count: "number"
                    }
                }
            },
            article: {
                name: 'News Article',
                schema: {
                    headline: "string",
                    author: "string",
                    publishDate: "string",
                    content: "string",
                    summary: "string",
                    tags: ["string"],
                    imageUrl: "string",
                    readTime: "number"
                }
            },
            contact: {
                name: 'Contact Information',
                schema: {
                    companyName: "string",
                    address: {
                        street: "string",
                        city: "string",
                        state: "string",
                        zip: "string",
                        country: "string"
                    },
                    phone: "string",
                    email: "string",
                    website: "string",
                    socialMedia: {
                        twitter: "string",
                        linkedin: "string",
                        facebook: "string"
                    }
                }
            },
            listing: {
                name: 'Real Estate Listing',
                schema: {
                    address: "string",
                    price: "number",
                    bedrooms: "number",
                    bathrooms: "number",
                    squareFeet: "number",
                    yearBuilt: "number",
                    description: "string",
                    features: ["string"],
                    images: ["string"],
                    agent: {
                        name: "string",
                        phone: "string",
                        email: "string"
                    }
                }
            }
        };

        const EXAMPLE_PROMPTS = {
            product: "Extract product information including title, price, availability, description, specifications, and customer ratings.",
            article: "Extract the article headline, author, publication date, main content, summary, and any tags or categories.",
            contact: "Find and extract all contact information including company name, address, phone numbers, email addresses, and social media links.",
            listing: "Extract real estate listing details including address, price, property features, description, and agent contact information.",
            general: "Extract all relevant structured information from this webpage, organizing it into logical categories."
        };

        function App() {
            const API_BASE = 'https://gxi4vg8gla.execute-api.us-west-2.amazonaws.com/dev/api';
            
            // State management
            const [activeTab, setActiveTab] = useState('scrape');
            const [loading, setLoading] = useState(false);
            const [jobs, setJobs] = useState([]);
            const [results, setResults] = useState({});
            const [expandedJobs, setExpandedJobs] = useState({});
            const [showHelp, setShowHelp] = useState(true);
            const [selectedExample, setSelectedExample] = useState('product');
            
            // Form states
            const [scrapeUrl, setScrapeUrl] = useState('');
            const [crawlUrl, setCrawlUrl] = useState('');
            const [extractUrl, setExtractUrl] = useState('');
            const [extractPrompt, setExtractPrompt] = useState(EXAMPLE_PROMPTS.product);
            const [extractSchema, setExtractSchema] = useState(JSON.stringify(EXAMPLE_SCHEMAS.product.schema, null, 2));
            
            // Scrape Options
            const [scrapeOptions, setScrapeOptions] = useState({
                waitFor: 'load',
                waitForSelector: '',
                screenshot: false,
                fullPage: false,
                javascriptEnabled: true,
                extractMainContent: false,
                includeHtml: true,
                includeMarkdown: true,
                timeout: 30000,
                scrollToBottom: false
            });
            
            // Crawl Options
            const [crawlOptions, setCrawlOptions] = useState({
                maxPages: 10,
                maxDepth: 2,
                waitBetween: 1000,
                followLinks: true,
                includePatterns: [],
                excludePatterns: [],
                sameDomainOnly: true,
                respectRobotsTxt: true
            });
            
            // Session Options
            const [sessionOptions, setSessionOptions] = useState({
                useProxy: false,
                proxyLocation: 'us',
                solveCaptchas: false,
                blockAds: true,
                blockTrackers: true,
                stealth: true,
                userAgent: ''
            });

            // Poll for job status
            useEffect(() => {
                const interval = setInterval(async () => {
                    const pendingJobs = jobs.filter(j => j.status === 'pending' || j.status === 'processing');
                    
                    for (const job of pendingJobs) {
                        try {
                            const response = await fetch(`${API_BASE}/${job.type}/${job.jobId}`, {
                                headers: { 'X-Api-Key': 'test-key-123' }
                            });
                            const data = await response.json();
                            
                            setResults(prev => ({
                                ...prev,
                                [job.jobId]: data
                            }));
                            
                            setJobs(prev => prev.map(j => 
                                j.jobId === job.jobId ? { 
                                    ...j, 
                                    status: data.status,
                                    updatedAt: new Date().toISOString()
                                } : j
                            ));
                        } catch (error) {
                            console.error('Failed to fetch job status:', error);
                        }
                    }
                }, 2000);

                return () => clearInterval(interval);
            }, [jobs]);

            const handleScrape = async () => {
                if (!scrapeUrl) {
                    alert('Please enter a URL to scrape');
                    return;
                }
                
                if (!scrapeUrl.startsWith('http://') && !scrapeUrl.startsWith('https://')) {
                    alert('Please enter a valid URL starting with http:// or https://');
                    return;
                }
                
                setLoading(true);
                try {
                    const response = await fetch(`${API_BASE}/scrape`, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'X-Api-Key': 'test-key-123'
                        },
                        body: JSON.stringify({
                            url: scrapeUrl,
                            ...scrapeOptions,
                            sessionOptions
                        })
                    });
                    const data = await response.json();
                    
                    setJobs(prev => [{
                        ...data,
                        type: 'scrape',
                        url: scrapeUrl,
                        createdAt: new Date().toISOString()
                    }, ...prev]);
                    
                    setExpandedJobs(prev => ({ ...prev, [data.jobId]: true }));
                    setScrapeUrl('');
                } catch (error) {
                    console.error('Scrape error:', error);
                    alert('Failed to create scrape job. Please try again.');
                } finally {
                    setLoading(false);
                }
            };

            const handleCrawl = async () => {
                if (!crawlUrl) {
                    alert('Please enter a starting URL for crawling');
                    return;
                }
                
                if (!crawlUrl.startsWith('http://') && !crawlUrl.startsWith('https://')) {
                    alert('Please enter a valid URL starting with http:// or https://');
                    return;
                }
                
                setLoading(true);
                try {
                    const response = await fetch(`${API_BASE}/crawl`, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'X-Api-Key': 'test-key-123'
                        },
                        body: JSON.stringify({
                            url: crawlUrl,
                            ...crawlOptions,
                            sessionOptions
                        })
                    });
                    const data = await response.json();
                    
                    setJobs(prev => [{
                        ...data,
                        type: 'crawl',
                        url: crawlUrl,
                        createdAt: new Date().toISOString()
                    }, ...prev]);
                    
                    setExpandedJobs(prev => ({ ...prev, [data.jobId]: true }));
                    setCrawlUrl('');
                } catch (error) {
                    console.error('Crawl error:', error);
                    alert('Failed to create crawl job. Please try again.');
                } finally {
                    setLoading(false);
                }
            };

            const handleExtract = async () => {
                if (!extractUrl) {
                    alert('Please enter a URL to extract data from');
                    return;
                }
                
                if (!extractUrl.startsWith('http://') && !extractUrl.startsWith('https://')) {
                    alert('Please enter a valid URL starting with http:// or https://');
                    return;
                }
                
                // Validate JSON schema if provided
                let schemaObj = null;
                if (extractSchema.trim()) {
                    try {
                        schemaObj = JSON.parse(extractSchema);
                    } catch (e) {
                        alert('Invalid JSON schema. Please check your syntax or use one of the examples.');
                        return;
                    }
                }
                
                setLoading(true);
                try {
                    const response = await fetch(`${API_BASE}/extract`, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'X-Api-Key': 'test-key-123'
                        },
                        body: JSON.stringify({
                            url: extractUrl,
                            prompt: extractPrompt,
                            schema: schemaObj,
                            sessionOptions
                        })
                    });
                    const data = await response.json();
                    
                    setJobs(prev => [{
                        ...data,
                        type: 'extract',
                        url: extractUrl,
                        createdAt: new Date().toISOString()
                    }, ...prev]);
                    
                    setExpandedJobs(prev => ({ ...prev, [data.jobId]: true }));
                    setExtractUrl('');
                } catch (error) {
                    console.error('Extract error:', error);
                    alert('Failed to create extract job. Please try again.');
                } finally {
                    setLoading(false);
                }
            };

            const loadExample = (exampleKey) => {
                setSelectedExample(exampleKey);
                setExtractPrompt(EXAMPLE_PROMPTS[exampleKey] || EXAMPLE_PROMPTS.general);
                if (EXAMPLE_SCHEMAS[exampleKey]) {
                    setExtractSchema(JSON.stringify(EXAMPLE_SCHEMAS[exampleKey].schema, null, 2));
                }
            };

            const downloadContent = (content, filename) => {
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
            };

            const InfoIcon = () => (
                <svg className="w-4 h-4 inline-block ml-1 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                    <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clipRule="evenodd" />
                </svg>
            );

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header */}
                    <div className="gradient-bg text-white p-6 shadow-lg">
                        <div className="max-w-7xl mx-auto">
                            <div className="flex items-center justify-between">
                                <div>
                                    <h1 className="text-3xl font-bold">Atlas Codex</h1>
                                    <p className="text-purple-100 mt-1">High-Performance Web Scraping Platform</p>
                                </div>
                                <button
                                    onClick={() => setShowHelp(!showHelp)}
                                    className="px-4 py-2 bg-white/20 rounded-lg hover:bg-white/30 transition-colors"
                                >
                                    {showHelp ? 'Hide' : 'Show'} Instructions
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="max-w-7xl mx-auto p-6">
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            
                            {/* Input Panel */}
                            <div className="glass-effect rounded-xl p-6">
                                {/* Tabs */}
                                <div className="flex space-x-2 mb-6">
                                    {['scrape', 'crawl', 'extract'].map(tab => (
                                        <button
                                            key={tab}
                                            onClick={() => setActiveTab(tab)}
                                            className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                                activeTab === tab ? 'tab-active' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                            }`}
                                        >
                                            {tab.charAt(0).toUpperCase() + tab.slice(1)}
                                        </button>
                                    ))}
                                </div>

                                {/* Scrape Tab */}
                                {activeTab === 'scrape' && (
                                    <div className="space-y-4">
                                        <div className="flex items-center justify-between">
                                            <h2 className="text-xl font-semibold text-gray-800">Scrape Single Page</h2>
                                            <span className="text-sm text-gray-500">Get content from one URL</span>
                                        </div>
                                        
                                        {showHelp && (
                                            <div className="info-box p-4 rounded-lg">
                                                <h3 className="font-semibold text-purple-900 mb-2">📖 How to use Scrape:</h3>
                                                <ol className="text-sm text-gray-700 space-y-1 list-decimal list-inside">
                                                    <li>Enter the complete URL of the webpage you want to scrape</li>
                                                    <li>Choose your options (screenshots, JavaScript rendering, etc.)</li>
                                                    <li>Click "Start Scraping" to begin</li>
                                                    <li>View results in the right panel when complete</li>
                                                </ol>
                                                <div className="mt-3 p-2 bg-white/50 rounded">
                                                    <p className="text-xs text-gray-600">
                                                        <strong>Tip:</strong> Enable JavaScript for dynamic sites like Twitter or Instagram. 
                                                        Use "Wait for Selector" if content loads slowly.
                                                    </p>
                                                </div>
                                            </div>
                                        )}
                                        
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                URL to Scrape
                                                <span className="text-red-500 ml-1">*</span>
                                            </label>
                                            <input
                                                type="url"
                                                value={scrapeUrl}
                                                onChange={(e) => setScrapeUrl(e.target.value)}
                                                placeholder="https://example.com/page-to-scrape"
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                            />
                                            <p className="text-xs text-gray-500 mt-1">Enter the full URL including https://</p>
                                        </div>
                                        
                                        {/* Scrape Options */}
                                        <div className="space-y-3">
                                            <h3 className="text-sm font-medium text-gray-700">
                                                Scraping Options
                                                <InfoIcon />
                                            </h3>
                                            
                                            <div className="grid grid-cols-2 gap-3">
                                                <label className="flex items-center text-sm cursor-pointer hover:bg-gray-50 p-2 rounded">
                                                    <input
                                                        type="checkbox"
                                                        checked={scrapeOptions.screenshot}
                                                        onChange={(e) => setScrapeOptions(prev => ({
                                                            ...prev,
                                                            screenshot: e.target.checked
                                                        }))}
                                                        className="mr-2 text-purple-600"
                                                    />
                                                    <span>Take screenshot</span>
                                                </label>
                                                
                                                {scrapeOptions.screenshot && (
                                                    <label className="flex items-center text-sm cursor-pointer hover:bg-gray-50 p-2 rounded">
                                                        <input
                                                            type="checkbox"
                                                            checked={scrapeOptions.fullPage}
                                                            onChange={(e) => setScrapeOptions(prev => ({
                                                                ...prev,
                                                                fullPage: e.target.checked
                                                            }))}
                                                            className="mr-2 text-purple-600"
                                                        />
                                                        <span>Full page screenshot</span>
                                                    </label>
                                                )}
                                                
                                                <label className="flex items-center text-sm cursor-pointer hover:bg-gray-50 p-2 rounded">
                                                    <input
                                                        type="checkbox"
                                                        checked={scrapeOptions.javascriptEnabled}
                                                        onChange={(e) => setScrapeOptions(prev => ({
                                                            ...prev,
                                                            javascriptEnabled: e.target.checked
                                                        }))}
                                                        className="mr-2 text-purple-600"
                                                    />
                                                    <span className="tooltip">
                                                        Enable JavaScript
                                                        <span className="tooltiptext">Required for dynamic websites</span>
                                                    </span>
                                                </label>
                                                
                                                <label className="flex items-center text-sm cursor-pointer hover:bg-gray-50 p-2 rounded">
                                                    <input
                                                        type="checkbox"
                                                        checked={scrapeOptions.scrollToBottom}
                                                        onChange={(e) => setScrapeOptions(prev => ({
                                                            ...prev,
                                                            scrollToBottom: e.target.checked
                                                        }))}
                                                        className="mr-2 text-purple-600"
                                                    />
                                                    <span className="tooltip">
                                                        Auto-scroll to bottom
                                                        <span className="tooltiptext">Loads lazy-loaded content</span>
                                                    </span>
                                                </label>
                                            </div>
                                            
                                            <div className="grid grid-cols-2 gap-3">
                                                <div>
                                                    <label className="block text-xs text-gray-600 mb-1">Wait For</label>
                                                    <select
                                                        value={scrapeOptions.waitFor}
                                                        onChange={(e) => setScrapeOptions(prev => ({
                                                            ...prev,
                                                            waitFor: e.target.value
                                                        }))}
                                                        className="w-full px-3 py-1 text-sm border border-gray-300 rounded"
                                                    >
                                                        <option value="load">Page Load (fastest)</option>
                                                        <option value="domcontentloaded">DOM Ready</option>
                                                        <option value="networkidle">Network Idle (slowest)</option>
                                                    </select>
                                                </div>
                                                
                                                <div>
                                                    <label className="block text-xs text-gray-600 mb-1">Timeout (ms)</label>
                                                    <input
                                                        type="number"
                                                        value={scrapeOptions.timeout}
                                                        onChange={(e) => setScrapeOptions(prev => ({
                                                            ...prev,
                                                            timeout: parseInt(e.target.value)
                                                        }))}
                                                        className="w-full px-3 py-1 text-sm border border-gray-300 rounded"
                                                    />
                                                </div>
                                            </div>
                                            
                                            <div>
                                                <label className="block text-xs text-gray-600 mb-1">
                                                    Wait for CSS Selector (optional)
                                                    <span className="ml-1 text-gray-400">e.g., .content, #main-article</span>
                                                </label>
                                                <input
                                                    type="text"
                                                    value={scrapeOptions.waitForSelector}
                                                    onChange={(e) => setScrapeOptions(prev => ({
                                                        ...prev,
                                                        waitForSelector: e.target.value
                                                    }))}
                                                    placeholder=".content-loaded"
                                                    className="w-full px-3 py-1 text-sm border border-gray-300 rounded"
                                                />
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Crawl Tab */}
                                {activeTab === 'crawl' && (
                                    <div className="space-y-4">
                                        <div className="flex items-center justify-between">
                                            <h2 className="text-xl font-semibold text-gray-800">Crawl Website</h2>
                                            <span className="text-sm text-gray-500">Discover & scrape multiple pages</span>
                                        </div>
                                        
                                        {showHelp && (
                                            <div className="info-box p-4 rounded-lg">
                                                <h3 className="font-semibold text-purple-900 mb-2">🕷️ How to use Crawl:</h3>
                                                <ol className="text-sm text-gray-700 space-y-1 list-decimal list-inside">
                                                    <li>Enter the starting URL (usually a homepage or category page)</li>
                                                    <li>Set max pages and depth to control scope</li>
                                                    <li>Use patterns to include/exclude specific URLs</li>
                                                    <li>The crawler will follow links and collect data from multiple pages</li>
                                                </ol>
                                                <div className="mt-3 p-2 bg-white/50 rounded">
                                                    <p className="text-xs text-gray-600">
                                                        <strong>Example patterns:</strong><br/>
                                                        Include: /blog/*, /products/*<br/>
                                                        Exclude: *.pdf, /admin/*
                                                    </p>
                                                </div>
                                            </div>
                                        )}
                                        
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Starting URL
                                                <span className="text-red-500 ml-1">*</span>
                                            </label>
                                            <input
                                                type="url"
                                                value={crawlUrl}
                                                onChange={(e) => setCrawlUrl(e.target.value)}
                                                placeholder="https://example.com"
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                            />
                                            <p className="text-xs text-gray-500 mt-1">The crawler will start here and follow links</p>
                                        </div>
                                        
                                        <div className="grid grid-cols-3 gap-3">
                                            <div>
                                                <label className="block text-xs text-gray-600 mb-1">
                                                    Max Pages
                                                    <span className="ml-1 text-gray-400">(limit)</span>
                                                </label>
                                                <input
                                                    type="number"
                                                    value={crawlOptions.maxPages}
                                                    onChange={(e) => setCrawlOptions(prev => ({
                                                        ...prev,
                                                        maxPages: parseInt(e.target.value)
                                                    }))}
                                                    className="w-full px-3 py-1 text-sm border border-gray-300 rounded"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-xs text-gray-600 mb-1">
                                                    Max Depth
                                                    <span className="ml-1 text-gray-400">(links away)</span>
                                                </label>
                                                <input
                                                    type="number"
                                                    value={crawlOptions.maxDepth}
                                                    onChange={(e) => setCrawlOptions(prev => ({
                                                        ...prev,
                                                        maxDepth: parseInt(e.target.value)
                                                    }))}
                                                    className="w-full px-3 py-1 text-sm border border-gray-300 rounded"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-xs text-gray-600 mb-1">
                                                    Delay (ms)
                                                    <span className="ml-1 text-gray-400">(be nice)</span>
                                                </label>
                                                <input
                                                    type="number"
                                                    value={crawlOptions.waitBetween}
                                                    onChange={(e) => setCrawlOptions(prev => ({
                                                        ...prev,
                                                        waitBetween: parseInt(e.target.value)
                                                    }))}
                                                    className="w-full px-3 py-1 text-sm border border-gray-300 rounded"
                                                />
                                            </div>
                                        </div>
                                        
                                        <div className="grid grid-cols-2 gap-3">
                                            <label className="flex items-center text-sm cursor-pointer hover:bg-gray-50 p-2 rounded">
                                                <input
                                                    type="checkbox"
                                                    checked={crawlOptions.sameDomainOnly}
                                                    onChange={(e) => setCrawlOptions(prev => ({
                                                        ...prev,
                                                        sameDomainOnly: e.target.checked
                                                    }))}
                                                    className="mr-2 text-purple-600"
                                                />
                                                <span>Stay on same domain</span>
                                            </label>
                                            
                                            <label className="flex items-center text-sm cursor-pointer hover:bg-gray-50 p-2 rounded">
                                                <input
                                                    type="checkbox"
                                                    checked={crawlOptions.respectRobotsTxt}
                                                    onChange={(e) => setCrawlOptions(prev => ({
                                                        ...prev,
                                                        respectRobotsTxt: e.target.checked
                                                    }))}
                                                    className="mr-2 text-purple-600"
                                                />
                                                <span>Respect robots.txt</span>
                                            </label>
                                        </div>
                                    </div>
                                )}

                                {/* Extract Tab */}
                                {activeTab === 'extract' && (
                                    <div className="space-y-4">
                                        <div className="flex items-center justify-between">
                                            <h2 className="text-xl font-semibold text-gray-800">AI Data Extraction</h2>
                                            <span className="text-sm text-gray-500">Structured data with GPT-4</span>
                                        </div>
                                        
                                        {showHelp && (
                                            <div className="info-box p-4 rounded-lg">
                                                <h3 className="font-semibold text-purple-900 mb-2">🤖 How to use AI Extract:</h3>
                                                <ol className="text-sm text-gray-700 space-y-1 list-decimal list-inside">
                                                    <li>Enter the URL containing data you want to extract</li>
                                                    <li>Describe what information you need in the prompt</li>
                                                    <li>Optionally define a JSON schema for structured output</li>
                                                    <li>AI will intelligently extract and format the data</li>
                                                </ol>
                                                <div className="mt-3 p-2 bg-white/50 rounded">
                                                    <p className="text-xs text-gray-600">
                                                        <strong>Pro tip:</strong> Use the example templates below for common extraction patterns!
                                                    </p>
                                                </div>
                                            </div>
                                        )}
                                        
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                URL to Extract From
                                                <span className="text-red-500 ml-1">*</span>
                                            </label>
                                            <input
                                                type="url"
                                                value={extractUrl}
                                                onChange={(e) => setExtractUrl(e.target.value)}
                                                placeholder="https://example.com/product-page"
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Extraction Instructions
                                                <span className="ml-2 text-xs text-gray-500">(Tell AI what to extract)</span>
                                            </label>
                                            <textarea
                                                value={extractPrompt}
                                                onChange={(e) => setExtractPrompt(e.target.value)}
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm"
                                                rows="3"
                                                placeholder="Extract product title, price, availability, and customer reviews..."
                                            />
                                        </div>
                                        
                                        <div>
                                            <div className="flex items-center justify-between mb-2">
                                                <label className="block text-sm font-medium text-gray-700">
                                                    JSON Schema
                                                    <span className="ml-2 text-xs text-gray-500">(Optional - defines output structure)</span>
                                                </label>
                                                <select
                                                    value={selectedExample}
                                                    onChange={(e) => loadExample(e.target.value)}
                                                    className="text-xs px-2 py-1 border border-gray-300 rounded"
                                                >
                                                    <option value="">Load Example...</option>
                                                    <option value="product">E-commerce Product</option>
                                                    <option value="article">News Article</option>
                                                    <option value="contact">Contact Info</option>
                                                    <option value="listing">Real Estate</option>
                                                </select>
                                            </div>
                                            <textarea
                                                value={extractSchema}
                                                onChange={(e) => setExtractSchema(e.target.value)}
                                                className="w-full px-3 py-2 font-mono text-xs border border-gray-300 rounded-lg bg-gray-50"
                                                rows="8"
                                                placeholder='{\n  "field_name": "data_type"\n}'
                                            />
                                            <p className="text-xs text-gray-500 mt-1">
                                                Valid types: "string", "number", "boolean", ["array"], {"object"}
                                            </p>
                                        </div>
                                        
                                        <div className="example-box p-3 rounded-lg">
                                            <h4 className="text-xs font-semibold text-gray-700 mb-2">📝 Quick Examples:</h4>
                                            <div className="grid grid-cols-2 gap-2">
                                                <button
                                                    onClick={() => {
                                                        setExtractUrl('https://www.amazon.com/dp/B08N5WRWNW');
                                                        loadExample('product');
                                                    }}
                                                    className="text-xs px-2 py-1 bg-white rounded border hover:bg-gray-50"
                                                >
                                                    Amazon Product
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        setExtractUrl('https://techcrunch.com/');
                                                        loadExample('article');
                                                    }}
                                                    className="text-xs px-2 py-1 bg-white rounded border hover:bg-gray-50"
                                                >
                                                    News Article
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        setExtractUrl('https://www.yelp.com/biz/');
                                                        loadExample('contact');
                                                    }}
                                                    className="text-xs px-2 py-1 bg-white rounded border hover:bg-gray-50"
                                                >
                                                    Business Info
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        setExtractUrl('https://www.zillow.com/');
                                                        loadExample('listing');
                                                    }}
                                                    className="text-xs px-2 py-1 bg-white rounded border hover:bg-gray-50"
                                                >
                                                    Real Estate
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}
                                
                                {/* Session Options - Always visible */}
                                <div className="mt-6 pt-6 border-t border-gray-200">
                                    <h3 className="text-sm font-medium text-gray-700 mb-3">
                                        Advanced Options
                                        <span className="ml-2 text-xs text-gray-500">(Optional)</span>
                                    </h3>
                                    <div className="grid grid-cols-2 gap-3">
                                        <label className="flex items-center text-sm cursor-pointer hover:bg-gray-50 p-2 rounded">
                                            <input
                                                type="checkbox"
                                                checked={sessionOptions.stealth}
                                                onChange={(e) => setSessionOptions(prev => ({
                                                    ...prev,
                                                    stealth: e.target.checked
                                                }))}
                                                className="mr-2 text-purple-600"
                                            />
                                            <span className="tooltip">
                                                Stealth Mode
                                                <span className="tooltiptext">Avoid bot detection</span>
                                            </span>
                                        </label>
                                        
                                        <label className="flex items-center text-sm cursor-pointer hover:bg-gray-50 p-2 rounded">
                                            <input
                                                type="checkbox"
                                                checked={sessionOptions.blockAds}
                                                onChange={(e) => setSessionOptions(prev => ({
                                                    ...prev,
                                                    blockAds: e.target.checked
                                                }))}
                                                className="mr-2 text-purple-600"
                                            />
                                            <span>Block Ads</span>
                                        </label>
                                    </div>
                                </div>
                                
                                {/* Action Button */}
                                <button
                                    onClick={
                                        activeTab === 'scrape' ? handleScrape :
                                        activeTab === 'crawl' ? handleCrawl :
                                        handleExtract
                                    }
                                    disabled={loading || (
                                        activeTab === 'scrape' ? !scrapeUrl :
                                        activeTab === 'crawl' ? !crawlUrl :
                                        !extractUrl
                                    )}
                                    className="w-full mt-6 py-3 bg-gradient-to-r from-purple-600 to-purple-700 text-white rounded-lg font-medium hover:from-purple-700 hover:to-purple-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                                >
                                    {loading ? (
                                        <span className="flex items-center justify-center">
                                            <div className="mini-loader mr-2"></div>
                                            Processing Request...
                                        </span>
                                    ) : (
                                        <span className="flex items-center justify-center">
                                            {activeTab === 'scrape' ? '🚀 Start Scraping' :
                                            activeTab === 'crawl' ? '🕷️ Start Crawling' :
                                            '🤖 Extract Data'}
                                        </span>
                                    )}
                                </button>
                            </div>

                            {/* Results Panel */}
                            <div className="glass-effect rounded-xl p-6">
                                <div className="flex items-center justify-between mb-4">
                                    <h2 className="text-xl font-semibold text-gray-800">Results</h2>
                                    {jobs.filter(j => j.status === 'pending' || j.status === 'processing').length > 0 && (
                                        <span className="flex items-center text-sm text-purple-600">
                                            <div className="mini-loader mr-2"></div>
                                            {jobs.filter(j => j.status === 'pending' || j.status === 'processing').length} active
                                        </span>
                                    )}
                                </div>
                                
                                {jobs.length === 0 ? (
                                    <div className="text-center py-12 text-gray-500">
                                        <svg className="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                        </svg>
                                        <p className="text-lg mb-2">No results yet</p>
                                        <p className="text-sm">Submit a job to see results here</p>
                                        {showHelp && (
                                            <div className="mt-4 text-xs text-gray-400">
                                                Results will appear here in real-time<br/>
                                                Click on any result to expand details
                                            </div>
                                        )}
                                    </div>
                                ) : (
                                    <div className="space-y-3 max-h-[600px] overflow-y-auto">
                                        {jobs.map(job => {
                                            const result = results[job.jobId];
                                            const isExpanded = expandedJobs[job.jobId];
                                            
                                            return (
                                                <div 
                                                    key={job.jobId} 
                                                    className={`border rounded-lg transition-all ${
                                                        job.status === 'failed' ? 'border-red-200 bg-red-50' :
                                                        job.status === 'completed' ? 'border-green-200 bg-green-50' :
                                                        job.status === 'processing' ? 'border-blue-200 bg-blue-50 animate-pulse' :
                                                        'border-yellow-200 bg-yellow-50'
                                                    }`}
                                                >
                                                    <div 
                                                        className="p-4 cursor-pointer hover:bg-white/50 transition-colors"
                                                        onClick={() => setExpandedJobs(prev => ({
                                                            ...prev,
                                                            [job.jobId]: !prev[job.jobId]
                                                        }))}
                                                    >
                                                        <div className="flex items-center justify-between">
                                                            <div className="flex items-center space-x-3">
                                                                {job.status === 'completed' && (
                                                                    <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                                                        <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                                                    </svg>
                                                                )}
                                                                {job.status === 'failed' && (
                                                                    <svg className="w-5 h-5 text-red-600" fill="currentColor" viewBox="0 0 20 20">
                                                                        <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                                                                    </svg>
                                                                )}
                                                                {(job.status === 'pending' || job.status === 'processing') && (
                                                                    <div className="mini-loader"></div>
                                                                )}
                                                                
                                                                <div className="flex-1">
                                                                    <div className="flex items-center space-x-2">
                                                                        <span className="font-medium text-gray-900">
                                                                            {job.type === 'scrape' ? '📄' : job.type === 'crawl' ? '🕷️' : '🤖'} {job.type.toUpperCase()}
                                                                        </span>
                                                                        <span className={`px-2 py-0.5 text-xs rounded-full font-medium ${
                                                                            job.status === 'completed' ? 'bg-green-200 text-green-800' :
                                                                            job.status === 'failed' ? 'bg-red-200 text-red-800' :
                                                                            job.status === 'processing' ? 'bg-blue-200 text-blue-800' :
                                                                            'bg-yellow-200 text-yellow-800'
                                                                        }`}>
                                                                            {job.status}
                                                                        </span>
                                                                    </div>
                                                                    <div className="text-xs text-gray-600 mt-1 truncate">
                                                                        {job.url}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            
                                                            <svg className={`w-5 h-5 text-gray-400 transform transition-transform ${isExpanded ? 'rotate-180' : ''}`} fill="currentColor" viewBox="0 0 20 20">
                                                                <path fillRule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clipRule="evenodd" />
                                                            </svg>
                                                        </div>
                                                    </div>
                                                    
                                                    {isExpanded && (
                                                        <div className="border-t border-gray-200 p-4 bg-white/70">
                                                            <div className="text-xs text-gray-500 mb-3 font-mono">
                                                                Job ID: {job.jobId}
                                                            </div>
                                                            
                                                            {(job.status === 'pending' || job.status === 'processing') && (
                                                                <div className="flex items-center space-x-2 text-sm text-blue-600">
                                                                    <div className="mini-loader"></div>
                                                                    <span>Processing your request... This typically takes 5-30 seconds.</span>
                                                                </div>
                                                            )}
                                                            
                                                            {result?.error && (
                                                                <div className="p-3 bg-red-100 border border-red-300 rounded-lg mb-3">
                                                                    <p className="text-sm font-medium text-red-800">Error occurred:</p>
                                                                    <p className="text-sm text-red-700 mt-1">{result.error}</p>
                                                                </div>
                                                            )}
                                                            
                                                            {result?.status === 'completed' && result?.result && (
                                                                <div className="space-y-4">
                                                                    {result.result.metadata && (
                                                                        <div>
                                                                            <h4 className="text-sm font-semibold text-gray-700 mb-2">📊 Page Metadata</h4>
                                                                            <div className="bg-gray-50 rounded-lg p-3 text-sm space-y-1">
                                                                                {result.result.metadata.title && (
                                                                                    <div><span className="font-medium">Title:</span> {result.result.metadata.title}</div>
                                                                                )}
                                                                                {result.result.metadata.description && (
                                                                                    <div><span className="font-medium">Description:</span> {result.result.metadata.description}</div>
                                                                                )}
                                                                            </div>
                                                                        </div>
                                                                    )}
                                                                    
                                                                    {result.result.extractedData && (
                                                                        <div>
                                                                            <h4 className="text-sm font-semibold text-gray-700 mb-2">🎯 Extracted Data</h4>
                                                                            <div className="bg-gray-900 rounded-lg p-3 overflow-x-auto">
                                                                                <pre className="text-xs text-green-400 font-mono">
                                                                                    {JSON.stringify(result.result.extractedData, null, 2)}
                                                                                </pre>
                                                                            </div>
                                                                            <button
                                                                                onClick={() => downloadContent(
                                                                                    JSON.stringify(result.result.extractedData, null, 2),
                                                                                    `${job.jobId}_data.json`
                                                                                )}
                                                                                className="mt-2 text-xs text-purple-600 hover:text-purple-700"
                                                                            >
                                                                                💾 Download JSON
                                                                            </button>
                                                                        </div>
                                                                    )}
                                                                    
                                                                    {result.result.pages && (
                                                                        <div>
                                                                            <h4 className="text-sm font-semibold text-gray-700 mb-2">
                                                                                🌐 Crawled {result.result.pagesVisited} Pages
                                                                            </h4>
                                                                            <div className="bg-gray-50 rounded-lg p-3 max-h-40 overflow-y-auto space-y-1">
                                                                                {result.result.pages.map((page, idx) => (
                                                                                    <div key={idx} className="text-sm">
                                                                                        <span className="text-gray-500">Level {page.depth}:</span> {page.title || page.url}
                                                                                    </div>
                                                                                ))}
                                                                            </div>
                                                                        </div>
                                                                    )}
                                                                    
                                                                    {result.result.markdown && (
                                                                        <div>
                                                                            <div className="flex items-center justify-between mb-2">
                                                                                <h4 className="text-sm font-semibold text-gray-700">📝 Content Preview</h4>
                                                                                <button 
                                                                                    onClick={() => downloadContent(result.result.markdown, `${job.jobId}.md`)}
                                                                                    className="text-xs text-purple-600 hover:text-purple-700 font-medium"
                                                                                >
                                                                                    💾 Download Full Content
                                                                                </button>
                                                                            </div>
                                                                            <div className="bg-gray-50 rounded-lg p-3 max-h-60 overflow-y-auto">
                                                                                <pre className="text-sm text-gray-700 whitespace-pre-wrap font-sans">
                                                                                    {result.result.markdown.substring(0, 1000)}
                                                                                    {result.result.markdown.length > 1000 && '\n\n... [Content truncated - download for full text]'}
                                                                                </pre>
                                                                            </div>
                                                                        </div>
                                                                    )}
                                                                </div>
                                                            )}
                                                        </div>
                                                    )}
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Footer Help */}
                    <div className="max-w-7xl mx-auto px-6 pb-6">
                        <div className="bg-gray-100 rounded-lg p-4">
                            <h3 className="font-semibold text-gray-800 mb-2">💡 Quick Tips:</h3>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600">
                                <div>
                                    <strong>Scrape:</strong> Best for single pages. Use JavaScript mode for dynamic content.
                                </div>
                                <div>
                                    <strong>Crawl:</strong> Discovers links automatically. Set depth=1 for immediate links only.
                                </div>
                                <div>
                                    <strong>Extract:</strong> AI understands context. Be specific in your prompt for best results.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>